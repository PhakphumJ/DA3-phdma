<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Phakphum Jatupitpornchan">

<title>Assignment3_code</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Assignment3_code_files/libs/clipboard/clipboard.min.js"></script>
<script src="Assignment3_code_files/libs/quarto-html/quarto.js"></script>
<script src="Assignment3_code_files/libs/quarto-html/popper.min.js"></script>
<script src="Assignment3_code_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Assignment3_code_files/libs/quarto-html/anchor.min.js"></script>
<link href="Assignment3_code_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Assignment3_code_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Assignment3_code_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Assignment3_code_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Assignment3_code_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="Assignment3_code_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="Assignment3_code_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Assignment3_code</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Phakphum Jatupitpornchan </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="task-1" class="level1">
<h1>Task 1</h1>
<p>Importing Data</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 2
    year     n
   &lt;dbl&gt; &lt;int&gt;
 1  2005 19147
 2  2006 20200
 3  2007 21804
 4  2008 23733
 5  2009 25596
 6  2010 26784
 7  2011 28222
 8  2012 28469
 9  2013 28474
10  2014 28151
11  2015 27506
12  2016  9743</code></pre>
</div>
</div>
<section id="sample-design" class="level2">
<h2 class="anchored" data-anchor-id="sample-design">Sample Design</h2>
<p>We will have 3 samples. 2011-2013 in Data_panel. However, in each sample, we will use values from the previous year as well to create variables such as growth of employment. Hence, in each data set, we will have 2 years of data. For example, in the first data set, we will have 2010 and 2011. In the second data set, we will have 2011 and 2012. In the third data set, we will have 2012 and 2013.</p>
<p>I restrict the sample to only those existed in t-1, t, t+1, and t+2 in the dataset.</p>
<section id="dealing-with-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-missing-values">Dealing with Missing Values</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 48 × 2
   variable       value
   &lt;chr&gt;          &lt;int&gt;
 1 D             207657
 2 finished_prod 192681
 3 wages         192106
 4 COGS          191864
 5 net_dom_sales 191864
 6 net_exp_sales 191864
 7 exit_year     184273
 8 exit_date     174336
 9 labor_avg      83195
10 birth_year     73055
# ℹ 38 more rows</code></pre>
</div>
</div>
<p>D, finished_prod, wages, COGS, net_dom_sales, net_exp_sales, exit_year, exit_date are missing from almost all observations. Hence, we will drop these variables.</p>
<p>birth_year will be used to calculate CEO age, which is an important variable. Hence, I drop observations with missing birth_year.</p>
<p>Based, on further inspection, I found that the missing values in founded_year, ceo_count, foreign, female, inoffice_days, gender, and origin can imputed by looking at the next year. For example:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 9
  comp_id  year founded_year ceo_count foreign female inoffice_days gender
    &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt; 
1 1003200  2005           NA        NA      NA     NA            NA &lt;NA&gt;  
2 1003200  2006           NA        NA      NA     NA            NA &lt;NA&gt;  
3 1003200  2007           NA        NA      NA     NA            NA &lt;NA&gt;  
4 1003200  2008           NA        NA      NA     NA            NA &lt;NA&gt;  
5 1003200  2009         2003         2       0      1          1754 female
6 1003200  2010         2003         2       0      1          1754 female
7 1003200  2011         2003         2       0      1          1754 female
# ℹ 1 more variable: origin &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 9
   comp_id  year founded_year ceo_count foreign female inoffice_days gender
     &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt; 
 1 1046213  2006           NA        NA      NA     NA           NA  &lt;NA&gt;  
 2 1046213  2007           NA        NA      NA     NA           NA  &lt;NA&gt;  
 3 1046213  2008         1998         2       1      0         2090. male  
 4 1046213  2009         1998         2       1      0         2090. male  
 5 1046213  2010         1998         1       1      0         3469  male  
 6 1046213  2011         1998         1       1      0         3469  male  
 7 1046213  2012         1998         1       1      0         3469  male  
 8 1046213  2013         1998         1       1      0         3469  male  
 9 1046213  2014         1998         3       1      0         2052. male  
10 1046213  2015         1998         3       1      0         2052. male  
11 1046213  2016         1998         3       1      0         2052. male  
# ℹ 1 more variable: origin &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 9
  comp_id  year founded_year ceo_count foreign female inoffice_days gender
    &lt;dbl&gt; &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;         &lt;dbl&gt; &lt;chr&gt; 
1 1084759  2005           NA        NA      NA     NA           NA  &lt;NA&gt;  
2 1084759  2006           NA        NA      NA     NA           NA  &lt;NA&gt;  
3 1084759  2007           NA        NA      NA     NA           NA  &lt;NA&gt;  
4 1084759  2008           NA        NA      NA     NA           NA  &lt;NA&gt;  
5 1084759  2009         1994         1       0      0          619  male  
6 1084759  2010         1994         2       0      0         1488. male  
7 1084759  2011         1994         1       0      0         2356  male  
# ℹ 1 more variable: origin &lt;chr&gt;</code></pre>
</div>
</div>
<p>However, it is not always the case that the values of these values are the same in each year. Hence, flag variables will be created to indicate that these are imputed.</p>
<p>Similar things can be observed with <em>birth_year</em>. It can be imputed by using the value in the next year. For example:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 11 × 5
   comp_id  year ceo_count female birth_year
     &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
 1 1046213  2006        NA     NA         NA
 2 1046213  2007        NA     NA         NA
 3 1046213  2008         2      0       1941
 4 1046213  2009         2      0       1941
 5 1046213  2010         1      0       1941
 6 1046213  2011         1      0       1941
 7 1046213  2012         1      0       1941
 8 1046213  2013         1      0       1941
 9 1046213  2014         3      0       1941
10 1046213  2015         3      0       1941
11 1046213  2016         3      0       1941</code></pre>
</div>
</div>
<p>However, it is possible that in some firms, CEO may not be the same person in each year. Hence, flag variables will be created to indicate that these are imputed.</p>
</section>
<section id="fixing-items-that-cannot-be-negative." class="level3">
<h3 class="anchored" data-anchor-id="fixing-items-that-cannot-be-negative.">Fixing items that cannot be negative.</h3>
<p>Items that cannot be negative: <em>extra_inc</em>, <em>inventories</em>, <em>personnel_exp</em>, <em>curr_liab</em>, <em>fixed_assets</em>, <em>curr_assets</em>, <em>intang_assets</em></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
     0      1 
207488     97 </code></pre>
</div>
</div>
</section>
</section>
<section id="label-engineering" class="level2">
<h2 class="anchored" data-anchor-id="label-engineering">Label Engineering</h2>
<p>The growth indicator I am interested in is profit. However, since profit can be negative, I will use sales/total cost instead. In the dataset, there is no information for total cost. However, this can be calculated by subtracting profit from sales and extra income.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The outcome variable (<em>fast_growing</em>) is an indicator of whether the firm achieves an <strong>outstanding annual growth rate in <em>sales_cost_ratio</em> for the next 2 consecutive years</strong>.</p>
<p>Outstanding annual growth rate is defined as having the highest 25% growth rate in the industry that year (4th quartile).</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 3
# Groups:   year [12]
    year outstanding_growth_rate_t1     n
   &lt;dbl&gt;                      &lt;dbl&gt; &lt;int&gt;
 1  2005                          0 14643
 2  2006                          0 11621
 3  2006                          1  3478
 4  2007                          0 13156
 5  2007                          1  3321
 6  2008                          0 13772
 7  2008                          1  3795
 8  2009                          0 13567
 9  2009                          1  4965
10  2010                          0 14901
# ℹ 11 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 3
# Groups:   year [12]
    year fast_growing     n
   &lt;dbl&gt;        &lt;dbl&gt; &lt;int&gt;
 1  2005            0 14643
 2  2006            0 14563
 3  2006            1   536
 4  2007            0 15996
 5  2007            1   481
 6  2008            0 16831
 7  2008            1   736
 8  2009            0 17498
 9  2009            1  1034
10  2010            0 18334
11  2010            1   647
12  2011            0 18540
13  2011            1   810
14  2012            0 18402
15  2012            1  1014
16  2013            0 18647
17  2013            1   648
18  2014            0 19509
19  2015            0 19359
20  2016            0  9429</code></pre>
</div>
</div>
<p>We have a problem of class imbalance as the fast growing companies only makes a small proportion of the sample. We will deal with this by downsampling the majority class later.</p>
<section id="feature-engineering" class="level3">
<h3 class="anchored" data-anchor-id="feature-engineering">Feature Engineering</h3>
<section id="generate-variables-new-variables" class="level4">
<h4 class="anchored" data-anchor-id="generate-variables-new-variables">Generate variables new variables</h4>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 2
# Groups:   ind2_cat [14]
   ind2_cat      n
      &lt;dbl&gt;  &lt;int&gt;
 1       20    515
 2       26  11750
 3       27   7361
 4       28  21608
 5       29   3676
 6       30   1766
 7       32   1521
 8       33  17837
 9       35      3
10       40   2045
11       55  20254
12       56 116139
13       60   2265
14       99    549</code></pre>
</div>
</div>
<p>Items that cannot be negative: <em>extra_inc</em>, <em>inventories</em>, <em>personnel_exp</em>, <em>curr_liab</em>, <em>fixed_assets</em>, <em>curr_assets</em>, <em>intang_assets</em></p>
<p>Fixed assets is important as it captures the capital intensity of the firm. The change in fixed assets is also important as it captures the investment activity of the firm.</p>
<p>Similarly, intangible assets is important in the same way as it captures the assets acquired mainly for the purpose of long-term growth.</p>
<p>Personnel expenditure is also another important variable. I create Personnel expenditure/ average number of employees. This may capture the talent level of the employees. The change in this ratio is also meaningful.</p>
<p>The growth of the number of employees is also potentially important. I create the growth rate of the number of employees.</p>
</section>
</section>
<section id="dealing-with-missing-values-again." class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-missing-values-again.">Dealing with missing values again.</h3>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 37 × 2
   variable                           value
   &lt;chr&gt;                              &lt;int&gt;
 1 intang_assets_growth_rate         170499
 2 personnel_exp_per_emp_growth_rate 102298
 3 emp_growth_rate                    96426
 4 personnel_exp_per_emp              64254
 5 emp_avg                            63418
 6 fixed_assets_growth_rate           59468
 7 growth_rate                        48512
 8 flag_extra_inc_problem             10249
 9 net_profit_margin                   9498
10 ind                                 6911
# ℹ 27 more rows</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
       n
   &lt;int&gt;
1 164782</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1 29344</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1  7545</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
      n
  &lt;int&gt;
1   528</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 37 × 2
   variable                          value
   &lt;chr&gt;                             &lt;int&gt;
 1 fixed_assets_growth_rate           2545
 2 ind                                2154
 3 personnel_exp_per_emp_growth_rate  1964
 4 intang_assets_growth_rate          1779
 5 ind2_cat                           1225
 6 emp_growth_rate                     762
 7 region_m                            218
 8 personnel_exp_per_emp               160
 9 flag_personnel_exp_problem          160
10 fixed_assets_ratio                  126
# ℹ 27 more rows</code></pre>
</div>
</div>
<p>After cleaning, only a few missing values are left. These observations are dropped.</p>
<section id="winsorize-and-simplyfying-variables" class="level4">
<h4 class="anchored" data-anchor-id="winsorize-and-simplyfying-variables">Winsorize and Simplyfying Variables</h4>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>There’s a few outliers. I winsorize at 1.00.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-54-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Winsorize at -1.50 and 0.80.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-56-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Leave it as it is.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Catagorize into 5 groups: -100%, -99% to -50%, -50% to 0%, 0% to 50%, &gt; 50%.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Leave it as it is.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Catagorize into 5 groups: -100%, -99% to -50%, -50% to 0%, 0% to 50%, &gt; 50%.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Leave it as it is.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Leave it as it is.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Assignment3_code_files/figure-html/unnamed-chunk-64-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Catagorize into 5 groups: -100%, -99% to -50%, -50% to 0%, 0% to 50%, &gt; 50%.</p>
</section>
</section>
</section>
<section id="downsampling" class="level2">
<h2 class="anchored" data-anchor-id="downsampling">Downsampling</h2>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
# Groups:   year [4]
   year fast_growing     n
  &lt;dbl&gt;        &lt;dbl&gt; &lt;int&gt;
1  2010            0 13624
2  2010            1   427
3  2011            0 13959
4  2011            1   579
5  2012            0 14113
6  2012            1   753
7  2013            0 14157
8  2013            1   459</code></pre>
</div>
</div>
<p>The ideal way to build and select the model is to build and evaluate the model within each year. However, due to time constraint and simplicity, I use data only from 2012 to build and choose the model. 2012 is the year with the most observations and the class is also the most balanced.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  fast_growing     n
         &lt;dbl&gt; &lt;int&gt;
1            0  6351
2            1   753</code></pre>
</div>
</div>
</section>
<section id="building-models" class="level2">
<h2 class="anchored" data-anchor-id="building-models">Building Models</h2>
<p>Three types of models are considered in this exercise. 1) Logistic Regression, 2) LASSO Logistic Regression, and 3) Random Forest. Details of each model are described in the following subsections.</p>
<p>The data is split into a work set and a hold-out set. 15% is used as the hold-out set for performance evaluation.</p>
<section id="logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h3>
<p>Five logistic regression models are built. General financial and economic knowledge is used to build the models. The following are the predictors used in each model.</p>
<ol type="1">
<li><p>Model 1: The growth rate of sales-to-total cost from 2011 to 2012 is used as the only predictor. This ratio is used to built the outcome variable. This is to see if past performance can predict future performance.</p></li>
<li><p>Model 2: Model 1 + variables capturing how well the firms are doing in terms of profitability, liquidity, and solvency. These are the most frequently used financial ratios.</p></li>
<li><p>Model 3: Model 2 + variables capturing labors, capital, and the past attempt to expand these inputs. These variables may capture the aspiration of the firms to grow.</p></li>
<li><p>Model 4: Model 3 + industry and interaction terms of the included variables with industry variable. These are important since each industry has different characteristics.</p></li>
<li><p>Model 5: Model 4. + the remaining variables.</p></li>
</ol>
<p>RMSE from the 5-fold cross validation is calculated for each model.</p>
<p>Logistic regression model 2 and 3 have the lowest RMSE.</p>
</section>
<section id="lasso-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="lasso-logistic-regression">LASSO Logistic Regression</h3>
<p>The parameter lambda is chosen by cross validation.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>glmnet 

6038 samples
  33 predictor
   2 classes: 'No', 'Yes' 

Pre-processing: centered (547), scaled (547) 
Resampling: Cross-Validated (5 fold) 
Summary of sample sizes: 4830, 4831, 4830, 4831, 4830 
Resampling results across tuning parameters:

  lambda        ROC        Sens       Spec         rmse     
  0.0001000000  0.6733158  0.9790845  0.088188976  0.3103420
  0.0001604217  0.6770899  0.9803803  0.085039370  0.3091616
  0.0002573513  0.6808467  0.9822313  0.078740157  0.3079143
  0.0004128473  0.6860854  0.9842670  0.074015748  0.3064566
  0.0006622968  0.6915664  0.9864885  0.067716535  0.3047842
  0.0010624678  0.6975091  0.9877846  0.064566929  0.3032747
  0.0017044291  0.7050003  0.9898200  0.056692913  0.3014931
  0.0027342745  0.7145080  0.9914858  0.036220472  0.2999954
  0.0043863700  0.7262930  0.9938920  0.023622047  0.2988302
  0.0070366900  0.7372153  0.9961132  0.015748031  0.2988778
  0.0112883789  0.7527407  0.9983338  0.006299213  0.2992969
  0.0181090112  0.7484377  0.9998150  0.000000000  0.3000081
  0.0290507865  0.7378321  1.0000000  0.000000000  0.3005603
  0.0466037703  0.7378321  1.0000000  0.000000000  0.3022482
  0.0747625680  0.5000000  1.0000000  0.000000000  0.3067689
  0.1199353946  0.5000000  1.0000000  0.000000000  0.3067689
  0.1924024183  0.5000000  1.0000000  0.000000000  0.3067689
  0.3086552612  0.5000000  1.0000000  0.000000000  0.3067689
  0.4951500669  0.5000000  1.0000000  0.000000000  0.3067689
  0.7943282347  0.5000000  1.0000000  0.000000000  0.3067689

Tuning parameter 'alpha' was held constant at a value of 1
ROC was used to select the optimal model using the largest value.
The final values used for the model were alpha = 1 and lambda = 0.01128838.</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Optimal lambda: 0.01128838 </code></pre>
</div>
</div>
</section>
<section id="random-forest" class="level3">
<h3 class="anchored" data-anchor-id="random-forest">Random Forest</h3>
<p>Next, I consider the random forest model. 5-fold cross-validation is used to tune the parameters (mtry: Number of variables randomly sampled as candidates at each split)</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Optimal mtry: 12 </code></pre>
</div>
</div>
</section>
<section id="compiling-the-results" class="level3">
<h3 class="anchored" data-anchor-id="compiling-the-results">Compiling the results</h3>
<p>First, the results (RMSE, AUC) of all 5 logistic regression models are compiled.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Model_Name</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">RMSE_Logit</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AUC_Logit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Logit 1</td>
<td style="text-align: center;">0.3063</td>
<td style="text-align: center;">0.6597</td>
</tr>
<tr class="even">
<td style="text-align: center;">Logit 2</td>
<td style="text-align: center;">0.3011</td>
<td style="text-align: center;">0.7177</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Logit 3</td>
<td style="text-align: center;">0.3011</td>
<td style="text-align: center;">0.7059</td>
</tr>
<tr class="even">
<td style="text-align: center;">Logit 4</td>
<td style="text-align: center;">0.3101</td>
<td style="text-align: center;">0.6704</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Logit 5</td>
<td style="text-align: center;">0.3111</td>
<td style="text-align: center;">0.6648</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Based on both RMSE and AUC, Logit 2 is the best model.</p>
<p>Next, compare the results with the LASSO and random forest models.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Model_Name</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">RMSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AUC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Logit 2</td>
<td style="text-align: center;">0.3011</td>
<td style="text-align: center;">0.7177</td>
</tr>
<tr class="even">
<td style="text-align: center;">LASSO</td>
<td style="text-align: center;">0.2993</td>
<td style="text-align: center;">0.7527</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Random Forest</td>
<td style="text-align: center;">0.2918</td>
<td style="text-align: center;">0.7712</td>
</tr>
</tbody>
</table>


</div>
</div>
<p>Random forest has the best performance in terms of both RMSE and AUC, followed by LAASO and Logit 2.</p>
</section>
</section>
<section id="part-2-minimizing-expected-loss." class="level2">
<h2 class="anchored" data-anchor-id="part-2-minimizing-expected-loss.">Part 2: Minimizing expected loss.</h2>
<p>When making false positive, the government is giving support to the firms that are not actually fast growing. In general, this reduces the allocative efficiency in the market. In worse case scenario, the supoort goes to waste as firms exit the market or the support is the factor allowing zombie firms to sustain.</p>
<p>On the other hand, false negative in this case is not as costly because firms that are actually fast growing should be able to grow without the support. They may only grow slower without the government support.</p>
<p>Based on the argument above, I would arbitrarily set the cost of false positive to be 1.3 times higher than that of false negative. I normalize the cost of false negative to be 100$. Hence, the cost of false positive is 130$.</p>
<p>The expected loss function is as follows:</p>
<p>$ E(Loss) = Cost of False Positive * P(False Positive) + Cost of False Negative * P(False Negative) $</p>
<p>Next, I find the optimal threshold that minimizes the expected loss for each model (Logit 2, LASSO, and Random Forest) using 5-fold cross-validation.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Optimal Threshold for Logit 2: 0.7 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Optimal Threshold for LASSO: 0.45 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Optimal Threshold for Random Forest: 0.95 </code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Optimal_Threshold</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Expected_Loss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Logit 2</td>
<td style="text-align: center;">0.70</td>
<td style="text-align: center;">2.0745</td>
</tr>
<tr class="even">
<td style="text-align: center;">LASSO</td>
<td style="text-align: center;">0.45</td>
<td style="text-align: center;">2.0787</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Random Forest</td>
<td style="text-align: center;">0.95</td>
<td style="text-align: center;">6.6263</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="part-3-confusion-matrix" class="level2">
<h2 class="anchored" data-anchor-id="part-3-confusion-matrix">Part 3: Confusion Matrix</h2>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Actual Fast Growing</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Actual Not Fast Growing</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Predicted Fast Growing</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Predicted Not Fast Growing</td>
<td style="text-align: center;">11.07</td>
<td style="text-align: center;">88.93</td>
<td style="text-align: center;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: center;">11.07</td>
<td style="text-align: center;">88.93</td>
<td style="text-align: center;">100</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">fast_growing</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">predicted_probs_logit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">0.5994343</td>
</tr>
<tr class="even">
<td style="text-align: left;">No</td>
<td style="text-align: right;">0.5892495</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">0.5887558</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">0.5531783</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">0.5390035</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Actual Fast Growing</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Actual Not Fast Growing</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Predicted Fast Growing</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Predicted Not Fast Growing</td>
<td style="text-align: center;">11.07</td>
<td style="text-align: center;">88.93</td>
<td style="text-align: center;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: center;">11.07</td>
<td style="text-align: center;">88.93</td>
<td style="text-align: center;">100</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">fast_growing</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">predicted_probs_lasso</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">0.1848321</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">0.1803520</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">0.1715486</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">0.1673537</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">0.1662427</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Actual Fast Growing</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Actual Not Fast Growing</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Predicted Fast Growing</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">0.00</td>
<td style="text-align: center;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">Predicted Not Fast Growing</td>
<td style="text-align: center;">11.07</td>
<td style="text-align: center;">88.93</td>
<td style="text-align: center;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total</td>
<td style="text-align: center;">11.07</td>
<td style="text-align: center;">88.93</td>
<td style="text-align: center;">100</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">fast_growing</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">predicted_probs_RF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">0.6533333</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">0.6533333</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">0.5733333</td>
</tr>
<tr class="even">
<td style="text-align: left;">Yes</td>
<td style="text-align: right;">0.5533333</td>
</tr>
<tr class="odd">
<td style="text-align: left;">No</td>
<td style="text-align: right;">0.5400000</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">model</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">RMSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AUC</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">expected_loss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">Logit</td>
<td style="text-align: center;">0.3038</td>
<td style="text-align: center;">0.7055</td>
<td style="text-align: center;">11.0694</td>
</tr>
<tr class="even">
<td style="text-align: center;">LASSO</td>
<td style="text-align: center;">0.3099</td>
<td style="text-align: center;">0.7505</td>
<td style="text-align: center;">11.0694</td>
</tr>
<tr class="odd">
<td style="text-align: center;">Random Forest</td>
<td style="text-align: center;">0.2983</td>
<td style="text-align: center;">0.7739</td>
<td style="text-align: center;">11.0694</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="task-2" class="level1">
<h1>Task 2</h1>
<p>We divide data into two dataset. First one contains only fimrs in manufacturing sector and the second one contains firms in all other sectors. <em>ind</em> = 2 is manufacturing sector. <em>ind</em> = 3 is service sector. sector.</p>
<p>I pick the logistic regression model 2 as to carry out classisification in both datasets as it is the model that minimize the expected loss in Task 1.</p>
<p>The expected loss and the optimal threshold are the same as before.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
    ind     n
  &lt;dbl&gt; &lt;int&gt;
1     1    51
2     2  1843
3     3  4144</code></pre>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed table-bordered table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: center;" data-quarto-table-cell-role="th">RMSE</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">AUC</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Expected_Loss</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Manufacturing Sector</td>
<td style="text-align: center;">0.3295</td>
<td style="text-align: center;">0.6936</td>
<td style="text-align: center;">12.9450</td>
</tr>
<tr class="even">
<td style="text-align: left;">Service Sector</td>
<td style="text-align: center;">0.2938</td>
<td style="text-align: center;">0.7352</td>
<td style="text-align: center;">10.3862</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>